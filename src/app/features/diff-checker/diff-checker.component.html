<div class="diff-checker-container">
  <!-- Header with title and actions -->
  <div class="header">
    <div class="header-left">
      <h1 class="title">Diff Checker</h1>
      <p class="subtitle">Compare text and code side-by-side</p>
    </div>
    <div class="header-right">
      <app-reset-button (reset)="onReset()"></app-reset-button>
      <button class="btn btn-icon" (click)="toggleTheme()" [title]="'Toggle theme'">
        <span *ngIf="monacoTheme === 'vs'">🌙</span>
        <span *ngIf="monacoTheme === 'vs-dark'">☀️</span>
      </button>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <!-- View mode selector -->
    <div class="toolbar-section">
      <label class="toolbar-label">View:</label>
      <div class="btn-group">
        <button
          class="btn btn-sm"
          [class.active]="viewMode === 'side-by-side'"
          (click)="setViewMode('side-by-side')"
          title="Side-by-side view">
          ⬌ Side-by-Side
        </button>
        <button
          class="btn btn-sm"
          [class.active]="viewMode === 'inline'"
          (click)="setViewMode('inline')"
          title="Inline view">
          ☰ Inline
        </button>
      </div>
    </div>

    <!-- Language selector -->
    <div class="toolbar-section">
      <label class="toolbar-label" for="language-select">Language:</label>
      <select
        id="language-select"
        class="select-input"
        [(ngModel)]="language"
        (change)="setLanguage(language)">
        <option *ngFor="let lang of availableLanguages" [value]="lang.value">
          {{ lang.label }}
        </option>
      </select>
    </div>

    <!-- Ignore options -->
    <div class="toolbar-section">
      <label class="checkbox-label">
        <input
          type="checkbox"
          [(ngModel)]="ignoreWhitespace"
          (change)="toggleIgnoreWhitespace()">
        <span>Ignore Whitespace</span>
      </label>
      <label class="checkbox-label">
        <input
          type="checkbox"
          [(ngModel)]="ignoreCase"
          (change)="toggleIgnoreCase()">
        <span>Ignore Case</span>
      </label>
    </div>

    <!-- Actions -->
    <div class="toolbar-section ml-auto">
      <button class="btn btn-sm" (click)="swapSides()" title="Swap left and right sides">
        ⇄ Swap
      </button>
      <button class="btn btn-sm" (click)="clearBothSides()" title="Clear both sides">
        ✕ Clear
      </button>
      <button class="btn btn-sm" (click)="toggleStatistics()" title="Toggle statistics">
        📊 Stats
      </button>
    </div>
  </div>

  <!-- File input controls -->
  <div class="file-controls">
    <div class="file-control-group">
      <button class="btn btn-file" (click)="openFileDialog('original')">
        📁 Load Original File
      </button>
      <button class="btn btn-file" (click)="copyOriginal()">
        📋 Copy
      </button>
    </div>
    <div class="file-control-group">
      <button class="btn btn-file" (click)="openFileDialog('modified')">
        📁 Load Modified File
      </button>
      <button class="btn btn-file" (click)="copyModified()">
        📋 Copy
      </button>
    </div>
  </div>

  <!-- Main content area -->
  <div class="content-area">
    <!-- Diff editor container -->
    <div
      class="diff-editor-wrapper"
      [class.with-sidebar]="showStatistics">

      <!-- Hidden file inputs -->
      <input
        type="file"
        #originalFileInput
        (change)="onOriginalFileSelected($event)"
        style="display: none"
        accept="*/*">
      <input
        type="file"
        #modifiedFileInput
        (change)="onModifiedFileSelected($event)"
        style="display: none"
        accept="*/*">

      <!-- Monaco Diff Editor Container -->
      <div
        #diffEditorContainer
        class="diff-editor-container"
        [class.inline-mode]="viewMode === 'inline'">
      </div>
    </div>

    <!-- Statistics sidebar -->
    <div class="statistics-sidebar" *ngIf="showStatistics">
      <div class="sidebar-header">
        <h3>Statistics</h3>
        <button class="btn-close" (click)="toggleStatistics()">✕</button>
      </div>

      <div class="stats-content">
        <!-- Change metrics -->
        <div class="stat-group">
          <h4>Changes</h4>
          <div class="stat-item added">
            <span class="stat-label">Added Lines</span>
            <span class="stat-value">{{ statistics.addedLines }}</span>
          </div>
          <div class="stat-item deleted">
            <span class="stat-label">Deleted Lines</span>
            <span class="stat-value">{{ statistics.deletedLines }}</span>
          </div>
          <div class="stat-item modified">
            <span class="stat-label">Modified Lines</span>
            <span class="stat-value">{{ statistics.modifiedLines }}</span>
          </div>
          <div class="stat-item total">
            <span class="stat-label">Total Changes</span>
            <span class="stat-value">{{ statistics.totalChanges }}</span>
          </div>
        </div>

        <!-- Similarity -->
        <div class="stat-group">
          <h4>Similarity</h4>
          <div class="similarity-meter">
            <div class="similarity-bar" [style.width.%]="statistics.similarity"></div>
          </div>
          <div class="similarity-text">{{ statistics.similarity }}%</div>
        </div>

        <!-- Export options -->
        <div class="stat-group">
          <h4>Export</h4>
          <button class="btn btn-block" (click)="copyDiff()">
            📋 Copy Diff
          </button>
          <button class="btn btn-block" (click)="exportAsPatch()">
            💾 Export as Patch
          </button>
          <button class="btn btn-block" (click)="exportAsHTML()">
            🌐 Export as HTML
          </button>
          <button class="btn btn-block" (click)="exportAsMarkdown()">
            📝 Export as Markdown
          </button>
          <button class="btn btn-block" (click)="exportAsJSON()">
            📊 Export as JSON
          </button>
        </div>

        <!-- Algorithm info (future use) -->
        <div class="stat-group">
          <h4>Algorithm</h4>
          <select
            class="select-input"
            [(ngModel)]="algorithm"
            (change)="setAlgorithm(algorithm)">
            <option *ngFor="let algo of algorithmOptions" [value]="algo.value">
              {{ algo.label }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom info bar -->
  <div class="info-bar">
    <div class="info-item">
      <span class="info-label">Changes:</span>
      <span class="info-value">
        <span class="badge badge-success">+{{ statistics.addedLines }}</span>
        <span class="badge badge-danger">-{{ statistics.deletedLines }}</span>
        <span class="badge badge-warning">~{{ statistics.modifiedLines }}</span>
      </span>
    </div>
    <div class="info-item">
      <span class="info-label">Similarity:</span>
      <span class="info-value">{{ statistics.similarity }}%</span>
    </div>
    <div class="info-item ml-auto">
      <span class="info-value text-muted">{{ viewMode === 'side-by-side' ? 'Side-by-Side' : 'Inline' }} | {{ language }}</span>
    </div>
  </div>
</div>
