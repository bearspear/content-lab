<div class="svg-editor-container">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <h1 class="title">SVG Editor & Optimizer</h1>
      <p class="subtitle">Edit, optimize, and convert SVG files</p>
    </div>
    <div class="header-right">
      <app-reset-button (reset)="onReset()"></app-reset-button>
      <button class="btn btn-icon" (click)="toggleTheme()" [title]="'Toggle theme'">
        <span *ngIf="monacoTheme === 'vs'">üåô</span>
        <span *ngIf="monacoTheme === 'vs-dark'">‚òÄÔ∏è</span>
      </button>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <!-- View mode selector -->
    <div class="toolbar-section">
      <label class="toolbar-label">View:</label>
      <div class="btn-group">
        <button
          class="btn btn-sm"
          [class.active]="viewMode === 'visual'"
          (click)="setViewMode('visual')"
          title="Visual mode">
          üëÅÔ∏è Visual
        </button>
        <button
          class="btn btn-sm"
          [class.active]="viewMode === 'code'"
          (click)="setViewMode('code')"
          title="Code mode">
          üìù Code
        </button>
        <button
          class="btn btn-sm"
          [class.active]="viewMode === 'split'"
          (click)="setViewMode('split')"
          title="Split view">
          ‚¨å Split
        </button>
      </div>
    </div>

    <!-- File actions -->
    <div class="toolbar-section">
      <button class="btn btn-sm" (click)="openFileDialog()" title="Open SVG file">
        üìÅ Open
      </button>
      <button class="btn btn-sm" (click)="formatCode()" title="Format code">
        ‚ú® Format
      </button>
      <button class="btn btn-sm" (click)="minifyCode()" title="Minify code">
        ‚ö° Minify
      </button>
    </div>

    <!-- Actions -->
    <div class="toolbar-section ml-auto">
      <button class="btn btn-sm" (click)="toggleOptimization()" title="Optimize SVG">
        ‚öôÔ∏è Optimize
      </button>
      <button class="btn btn-sm" (click)="toggleExport()" title="Export SVG">
        üì§ Export
      </button>
      <button class="btn btn-sm" (click)="copySvgCode()" title="Copy SVG code">
        üìã Copy
      </button>
    </div>
  </div>

  <!-- Hidden file input -->
  <input
    type="file"
    #fileInput
    (change)="onFileSelected($event)"
    accept=".svg"
    style="display: none">

  <!-- Main content area -->
  <div class="content-area">
    <!-- Visual Preview (when visible) -->
    <div
      class="preview-panel"
      *ngIf="viewMode === 'visual' || viewMode === 'split'"
      [class.half-width]="viewMode === 'split'"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
      [class.drag-over]="isDragOver">

      <div class="panel-header">
        <h3>Preview</h3>
        <button class="btn btn-icon-sm" (click)="toggleProperties()">
          {{ showProperties ? '‚ñº' : '‚ñ∂' }}
        </button>
      </div>

      <div class="preview-content">
        <!-- SVG Preview -->
        <div class="svg-preview-wrapper">
          <div
            #svgPreview
            class="svg-preview"
            [class.invalid]="!isValid">
          </div>

          <div *ngIf="!isValid" class="error-overlay">
            <div class="error-message">
              <h4>Invalid SVG</h4>
              <p>{{ validationError }}</p>
            </div>
          </div>

          <div *ngIf="isDragOver" class="drop-overlay">
            <div class="drop-message">
              <h3>üìÅ Drop SVG file here</h3>
            </div>
          </div>
        </div>

        <!-- Properties Panel -->
        <div class="properties-panel" *ngIf="showProperties">
          <h4>Properties</h4>

          <div class="property-group">
            <label>Width</label>
            <input
              type="number"
              [(ngModel)]="width"
              (change)="updateDimensions()"
              class="input-sm">
          </div>

          <div class="property-group">
            <label>Height</label>
            <input
              type="number"
              [(ngModel)]="height"
              (change)="updateDimensions()"
              class="input-sm">
          </div>

          <div class="property-group">
            <label>ViewBox</label>
            <input
              type="text"
              [(ngModel)]="viewBox"
              (change)="updateViewBox()"
              class="input-sm"
              placeholder="x y width height">
          </div>

          <!-- Color Palette -->
          <div class="property-group" *ngIf="extractedColors.length > 0">
            <label>Colors ({{ extractedColors.length }})</label>
            <div class="color-palette">
              <div
                *ngFor="let color of extractedColors"
                class="color-swatch"
                [style.background-color]="color"
                [title]="color">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Code Editor (when visible) -->
    <div
      class="code-panel"
      *ngIf="viewMode === 'code' || viewMode === 'split'"
      [class.half-width]="viewMode === 'split'">

      <div class="panel-header">
        <h3>Code Editor</h3>
        <span class="validation-badge" [class.valid]="isValid" [class.invalid]="!isValid">
          {{ isValid ? '‚úì Valid' : '‚úó Invalid' }}
        </span>
      </div>

      <div #codeEditorContainer class="code-editor-container"></div>
    </div>

    <!-- Optimization Panel (overlay) -->
    <div class="modal-overlay" *ngIf="showOptimization" (click)="showOptimization = false">
      <div class="modal-panel" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Optimize SVG</h3>
          <button class="btn-close" (click)="showOptimization = false">‚úï</button>
        </div>

        <div class="modal-body">
          <div class="optimization-options">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="removeComments">
              <span>Remove comments</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="removeMetadata">
              <span>Remove metadata (title, desc)</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="removeHidden">
              <span>Remove hidden elements</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="minifyColors">
              <span>Minify colors (#rrggbb ‚Üí #rgb)</span>
            </label>

            <div class="option-group">
              <label>Round numbers to decimals:</label>
              <input
                type="number"
                [(ngModel)]="roundNumbers"
                min="0"
                max="6"
                class="input-sm">
            </div>
          </div>

          <div class="optimization-result" *ngIf="optimizationResult">
            <div class="result-item">
              <span class="label">Original Size:</span>
              <span class="value">{{ formatBytes(optimizationResult.originalSize) }}</span>
            </div>
            <div class="result-item">
              <span class="label">Optimized Size:</span>
              <span class="value">{{ formatBytes(optimizationResult.optimizedSize) }}</span>
            </div>
            <div class="result-item highlight">
              <span class="label">Savings:</span>
              <span class="value">{{ formatBytes(optimizationResult.savings) }} ({{ optimizationResult.savingsPercent }}%)</span>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn" (click)="showOptimization = false">Cancel</button>
          <button class="btn btn-primary" (click)="optimizeSvg()">Preview Optimization</button>
          <button
            class="btn btn-success"
            *ngIf="optimizationResult"
            (click)="applyOptimization()">
            Apply Optimization
          </button>
        </div>
      </div>
    </div>

    <!-- Export Panel (overlay) -->
    <div class="modal-overlay" *ngIf="showExport" (click)="showExport = false">
      <div class="modal-panel" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Export SVG</h3>
          <button class="btn-close" (click)="showExport = false">‚úï</button>
        </div>

        <div class="modal-body">
          <div class="export-options">
            <div class="option-group">
              <label>Format:</label>
              <select [(ngModel)]="exportFormat" class="select-input">
                <option value="svg">SVG (Optimized)</option>
                <option value="png">PNG</option>
                <option value="datauri">Data URI (Base64)</option>
                <option value="react">React Component</option>
                <option value="vue">Vue Component</option>
              </select>
            </div>

            <div class="option-group" *ngIf="exportFormat === 'png'">
              <label>Width:</label>
              <input
                type="number"
                [(ngModel)]="exportWidth"
                class="input-sm">
            </div>

            <div class="option-group" *ngIf="exportFormat === 'png'">
              <label>Height:</label>
              <input
                type="number"
                [(ngModel)]="exportHeight"
                class="input-sm">
            </div>

            <label class="checkbox-label" *ngIf="exportFormat === 'png'">
              <input type="checkbox" [(ngModel)]="lockAspect">
              <span>Lock aspect ratio</span>
            </label>
          </div>

          <div class="export-preview">
            <p class="info-text">
              <strong>Format:</strong>
              <span *ngIf="exportFormat === 'svg'">Optimized SVG file</span>
              <span *ngIf="exportFormat === 'png'">PNG image ({{ exportWidth }}x{{ exportHeight }})</span>
              <span *ngIf="exportFormat === 'datauri'">Base64 data URI for inline use</span>
              <span *ngIf="exportFormat === 'react'">React component with props</span>
              <span *ngIf="exportFormat === 'vue'">Vue Single File Component</span>
            </p>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn" (click)="showExport = false">Cancel</button>
          <button class="btn btn-primary" (click)="exportSvg()">
            {{ exportFormat === 'svg' || exportFormat === 'png' ? 'Download' : 'Copy to Clipboard' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Info Bar -->
  <div class="info-bar">
    <div class="info-item">
      <span class="info-label">Size:</span>
      <span class="info-value">{{ formatBytes(svgInfo.fileSize) }}</span>
    </div>
    <div class="info-item">
      <span class="info-label">Elements:</span>
      <span class="info-value">{{ svgInfo.elementCount }}</span>
    </div>
    <div class="info-item">
      <span class="info-label">Dimensions:</span>
      <span class="info-value">{{ width || '‚Äî' }} √ó {{ height || '‚Äî' }}</span>
    </div>
    <div class="info-item">
      <span class="info-label">ViewBox:</span>
      <span class="info-value">{{ viewBox || 'None' }}</span>
    </div>
    <div class="info-item ml-auto">
      <span class="info-value text-muted">{{ viewMode === 'visual' ? 'Visual' : viewMode === 'code' ? 'Code' : 'Split View' }}</span>
    </div>
  </div>
</div>
