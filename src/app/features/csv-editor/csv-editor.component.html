<div class="csv-editor">
  <!-- Header -->
  <div class="editor-header">
    <div class="header-left">
      <h1>CSV/TSV Editor</h1>
      <div class="stats" *ngIf="!showImportDialog">
        <span class="stat-item">{{ rowCount }} rows</span>
        <span class="stat-separator">â€¢</span>
        <span class="stat-item">{{ columnCount }} columns</span>
      </div>
    </div>
    <div class="header-actions">
      <ng-container *ngIf="!showImportDialog">
      <button class="btn btn-secondary" (click)="addRow()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Add Row
      </button>
      <button class="btn btn-secondary" (click)="addColumn()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Add Column
      </button>
      <div class="export-dropdown">
        <button class="btn btn-primary" (click)="exportData('csv')">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
          </svg>
          Export
        </button>
        <div class="dropdown-content">
          <button (click)="exportData('csv')">CSV</button>
          <button (click)="exportData('json')">JSON</button>
          <button (click)="exportData('sql')">SQL</button>
          <button (click)="exportData('markdown')">Markdown</button>
        </div>
      </div>
      <button class="btn btn-danger" (click)="clearData()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Clear
      </button>
      </ng-container>
      <app-reset-button (reset)="onReset()"></app-reset-button>
    </div>
  </div>

  <!-- Import Dialog -->
  <div class="import-dialog" *ngIf="showImportDialog"
       (dragover)="onDragOver($event)"
       (dragleave)="onDragLeave($event)"
       (drop)="onDrop($event)">
    <div class="import-card" [class.dragging]="isDragging">
      <h2>Import CSV/TSV Data</h2>

      <div class="import-options">
        <label class="option-group">
          <span>Delimiter:</span>
          <div class="delimiter-buttons">
            <button class="delimiter-btn" [class.active]="delimiter === ','" (click)="switchDelimiter(',')">Comma (,)</button>
            <button class="delimiter-btn" [class.active]="delimiter === '\t'" (click)="switchDelimiter('\t')">Tab (\t)</button>
            <button class="delimiter-btn" [class.active]="delimiter === ';'" (click)="switchDelimiter(';')">Semicolon (;)</button>
            <button class="delimiter-btn" [class.active]="delimiter === '|'" (click)="switchDelimiter('|')">Pipe (|)</button>
          </div>
        </label>

        <label class="checkbox-option">
          <input type="checkbox" [(ngModel)]="hasHeader">
          <span>First row is header</span>
        </label>
      </div>

      <div class="import-methods">
        <div class="method-card">
          <h3>Paste CSV Data</h3>
          <textarea
            [(ngModel)]="csvInput"
            placeholder="Paste your CSV/TSV data here...&#10;Example:&#10;Name,Age,City&#10;John,30,New York&#10;Jane,25,Los Angeles"
            rows="10"
          ></textarea>
          <button class="btn btn-primary" (click)="parseCSV()">Parse Data</button>
        </div>

        <div class="method-divider">
          <span>OR</span>
        </div>

        <div class="method-card">
          <h3>Upload CSV File</h3>
          <div class="drop-zone" [class.active]="isDragging">
            <input type="file" #fileInput accept=".csv,.tsv,.txt" (change)="onFileSelected($event)" style="display: none;">
            <div class="drop-zone-content">
              <svg class="drop-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
              </svg>
              <p class="drop-text" *ngIf="!isDragging">Drag and drop your file here</p>
              <p class="drop-text dropping" *ngIf="isDragging">Drop file to upload</p>
              <p class="drop-divider">or</p>
              <button class="btn btn-secondary upload-btn" (click)="fileInput.click()">
                Choose File
              </button>
            </div>
          </div>
          <p class="upload-hint">Supports .csv, .tsv, and .txt files</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Table View -->
  <div class="table-container" *ngIf="!showImportDialog">
    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th class="row-number-header">#</th>
            <th *ngFor="let header of headers; let i = index" class="column-header">
              <div class="header-content">
                <span class="header-text" (dblclick)="renameColumn(i)">{{ header }}</span>
                <button class="sort-btn" (click)="sortByColumn(i)" [title]="'Sort by ' + header">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"
                          *ngIf="sortColumn !== i"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M5 15l7-7 7 7"
                          *ngIf="sortColumn === i && sortDirection === 'asc'"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M19 9l-7 7-7-7"
                          *ngIf="sortColumn === i && sortDirection === 'desc'"/>
                  </svg>
                </button>
                <button class="delete-btn" (click)="deleteColumn(i)" title="Delete column">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
            </th>
            <th class="actions-header"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of rows; let rowIndex = index" class="data-row">
            <td class="row-number">{{ rowIndex + 1 }}</td>
            <td *ngFor="let cell of row; let colIndex = index" class="data-cell">
              <input
                *ngIf="cell.isEditing"
                type="text"
                [(ngModel)]="cell.value"
                (blur)="stopEditing(rowIndex, colIndex)"
                (keyup.enter)="stopEditing(rowIndex, colIndex)"
                (keyup.escape)="stopEditing(rowIndex, colIndex)"
                class="cell-input"
                autofocus
              />
              <span
                *ngIf="!cell.isEditing"
                (dblclick)="startEditing(rowIndex, colIndex)"
                class="cell-content"
              >{{ cell.value || '(empty)' }}</span>
            </td>
            <td class="actions-cell">
              <button class="delete-row-btn" (click)="deleteRow(rowIndex)" title="Delete row">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Export Dialog -->
  <div class="modal-overlay" *ngIf="showExportDialog" (click)="showExportDialog = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Export as {{ exportFormat.toUpperCase() }}</h2>
        <button class="close-btn" (click)="showExportDialog = false">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="export-options" *ngIf="exportFormat === 'sql'">
          <label>
            <span>Table Name:</span>
            <input type="text" [(ngModel)]="tableName" placeholder="table_data">
          </label>
        </div>

        <div class="export-preview">
          <pre>{{ exportOutput }}</pre>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="copyToClipboard()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
          </svg>
          Copy
        </button>
        <button class="btn btn-primary" (click)="downloadExport()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
          </svg>
          Download
        </button>
      </div>
    </div>
  </div>
</div>
