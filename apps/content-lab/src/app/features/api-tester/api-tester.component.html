<div class="api-tester-container">
  <!-- Sidebar Toggle Button -->
  <button class="sidebar-toggle" (click)="toggleSidebar()" [title]="sidebarCollapsed ? 'Show Sidebar' : 'Hide Sidebar'">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
      <line x1="9" y1="3" x2="9" y2="21"/>
    </svg>
  </button>

  <!-- Sidebar -->
  <div class="sidebar-container" [class.collapsed]="sidebarCollapsed">
    <app-sidebar
      (requestSelected)="onRequestSelected($event)"
    ></app-sidebar>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Request Builder -->
    <div class="request-section">
      <app-request-builder
        [request]="currentRequest$ | async"
        [isLoading]="isLoading$ | async"
        (requestChange)="onRequestChange($event)"
        (sendRequest)="onSendRequest($event)"
        (saveRequest)="onSaveRequest($event)"
      ></app-request-builder>
    </div>

    <!-- Response Viewer -->
    <div class="response-section">
      <app-response-viewer
        [response]="currentResponse$ | async"
        [isLoading]="isLoading$ | async"
      ></app-response-viewer>
    </div>
  </div>
</div>

<!-- Save Request Modal -->
<div *ngIf="showSaveModal" class="modal-overlay" (click)="showSaveModal = false">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Save Request</h3>
      <button class="icon-button" (click)="showSaveModal = false">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Request Name</label>
        <input
          type="text"
          [(ngModel)]="saveRequestName"
          placeholder="My API Request"
          (keyup.enter)="onConfirmSave()" />
      </div>
      <div class="form-group">
        <label>Collection</label>
        <select [(ngModel)]="saveSelectedCollection">
          <option *ngFor="let collection of collections" [value]="collection.id">
            {{ collection.name }}
          </option>
        </select>
      </div>
      <div class="form-group" *ngIf="collections.length > 0 && saveSelectedCollection">
        <label>Folder (optional)</label>
        <select [(ngModel)]="saveSelectedFolder">
          <option value="">-- Root --</option>
          <option *ngFor="let folder of getSelectedCollectionFolders()" [value]="folder.id">
            {{ folder.name }}
          </option>
        </select>
      </div>
      <div *ngIf="collections.length === 0" class="no-collections-message">
        <p>No collections available. Create one in the sidebar first.</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="secondary-button" (click)="showSaveModal = false">Cancel</button>
      <button
        class="primary-button"
        (click)="onConfirmSave()"
        [disabled]="!saveRequestName.trim() || !saveSelectedCollection || collections.length === 0">
        Save
      </button>
    </div>
  </div>
</div>
