<div class="regex-tester-container">
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <h1>RegEx Tester</h1>
      <p class="subtitle">Professional regex testing and debugging environment</p>
    </div>
    <div class="header-actions">
      <app-reset-button (reset)="onReset()"></app-reset-button>
    </div>
  </header>

  <!-- Mode Tabs -->
  <div class="mode-tabs">
    <button class="tab-btn" [class.active]="activeMode === 'test'" (click)="setMode('test')">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
      </svg>
      Test
    </button>
    <button class="tab-btn" [class.active]="activeMode === 'replace'" (click)="setMode('replace')">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12M8 12h12m-7 5h7"/>
      </svg>
      Replace
    </button>
    <button class="tab-btn" [class.active]="activeMode === 'explain'" (click)="setMode('explain')">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      Explain
    </button>
    <button class="tab-btn" [class.active]="activeMode === 'library'" (click)="setMode('library')">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"/>
      </svg>
      Library
    </button>
  </div>

  <!-- Pattern Input Section -->
  <div class="pattern-section">
    <div class="pattern-input-wrapper">
      <label class="input-label">
        <span class="label-text">Regular Expression Pattern</span>
        <span class="pattern-display">/{{ pattern || '...' }}/{{ getFlagString() }}</span>
      </label>
      <input
        type="text"
        class="pattern-input"
        [(ngModel)]="pattern"
        (ngModelChange)="onPatternChange()"
        placeholder="Enter your regex pattern here..."
        spellcheck="false"
      />
      <div class="pattern-status">
        <span *ngIf="isValid" class="status-valid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
          Valid pattern
        </span>
        <span *ngIf="error" class="status-error">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
          {{ error }}
        </span>
      </div>
    </div>

    <!-- Flags Panel -->
    <div class="flags-panel">
      <span class="flags-label">Flags:</span>
      <button class="flag-btn" [class.active]="flags.global" (click)="toggleFlag('global')" title="Global - Find all matches">
        g
      </button>
      <button class="flag-btn" [class.active]="flags.caseInsensitive" (click)="toggleFlag('caseInsensitive')" title="Case insensitive">
        i
      </button>
      <button class="flag-btn" [class.active]="flags.multiline" (click)="toggleFlag('multiline')" title="Multiline - ^ and $ match line boundaries">
        m
      </button>
      <button class="flag-btn" [class.active]="flags.dotAll" (click)="toggleFlag('dotAll')" title="Dot all - . matches newlines">
        s
      </button>
      <button class="flag-btn" [class.active]="flags.unicode" (click)="toggleFlag('unicode')" title="Unicode">
        u
      </button>
      <button class="flag-btn" [class.active]="flags.sticky" (click)="toggleFlag('sticky')" title="Sticky - Match from lastIndex only">
        y
      </button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="content-area">
    <!-- Test Mode -->
    <div *ngIf="activeMode === 'test'" class="mode-content">
      <div class="test-layout">
        <!-- Test Strings Input -->
        <div class="test-strings-section">
          <div class="section-header">
            <h3>Test Strings</h3>
            <div class="header-actions-small">
              <button class="icon-btn" (click)="copyToClipboard(testString)" title="Copy to clipboard">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </button>
            </div>
          </div>
          <textarea
            class="test-textarea"
            [(ngModel)]="testString"
            (ngModelChange)="onTestStringChange()"
            placeholder="Enter or paste text to test your regex pattern..."
            spellcheck="false"
          ></textarea>
        </div>

        <!-- Results Section -->
        <div class="results-section">
          <div class="section-header">
            <h3>Matches ({{ matches.length }})</h3>
            <div class="header-actions-small" *ngIf="matches.length > 0">
              <button class="icon-btn" (click)="exportMatches('json')" title="Export as JSON">
                JSON
              </button>
              <button class="icon-btn" (click)="exportMatches('csv')" title="Export as CSV">
                CSV
              </button>
              <button class="icon-btn" (click)="exportMatches('array')" title="Export as Array">
                Array
              </button>
            </div>
          </div>

          <!-- Highlighted Text -->
          <div class="highlighted-text" [innerHTML]="getHighlightedText()"></div>

          <!-- Match Details -->
          <div class="matches-list" *ngIf="matches.length > 0">
            <div class="match-item" *ngFor="let match of matches; let i = index">
              <div class="match-header">
                <span class="match-index">Match {{ i + 1 }}</span>
                <span class="match-position">&#64; index {{ match.index }}</span>
                <button class="icon-btn-small" (click)="copyToClipboard(match.fullMatch)" title="Copy match">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                  </svg>
                </button>
              </div>
              <div class="match-value">"{{ match.fullMatch }}"</div>
              <div class="match-groups" *ngIf="match.groups.length > 0">
                <div class="group-item" *ngFor="let group of match.groups; let g = index">
                  <span class="group-label">${{ g + 1 }}:</span>
                  <span class="group-value">"{{ group }}"</span>
                </div>
              </div>
            </div>
          </div>

          <!-- No Matches Message -->
          <div class="no-matches" *ngIf="matches.length === 0 && isValid && testString">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <p>No matches found</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Replace Mode -->
    <div *ngIf="activeMode === 'replace'" class="mode-content">
      <div class="replace-layout">
        <div class="replace-input-section">
          <label class="input-label">
            <span class="label-text">Replacement String</span>
            <span class="hint-text">Use $1, $2, etc. for capture groups</span>
          </label>
          <input
            type="text"
            class="replacement-input"
            [(ngModel)]="replacement"
            (ngModelChange)="onReplacementChange()"
            placeholder="Enter replacement pattern..."
            spellcheck="false"
          />
        </div>

        <div class="before-after-layout">
          <div class="before-section">
            <h3>Before ({{ matches.length }} matches)</h3>
            <div class="preview-box" [innerHTML]="getHighlightedText()"></div>
          </div>

          <div class="arrow-divider">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
            </svg>
          </div>

          <div class="after-section">
            <h3>After</h3>
            <div class="preview-box">{{ replacedString }}</div>
          </div>
        </div>

        <div class="replace-actions">
          <button class="action-btn" (click)="copyToClipboard(replacedString)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
            Copy Result
          </button>
        </div>
      </div>
    </div>

    <!-- Explain Mode -->
    <div *ngIf="activeMode === 'explain'" class="mode-content">
      <div class="explain-layout">
        <div class="explanation-section">
          <h3>Pattern Explanation</h3>
          <div class="pattern-display-large">/{{ pattern || '...' }}/{{ getFlagString() }}</div>

          <div class="explanation-list" *ngIf="getExplanation().length > 0">
            <div class="explanation-item" *ngFor="let exp of getExplanation()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
              <span>{{ exp }}</span>
            </div>
          </div>

          <div class="no-explanation" *ngIf="getExplanation().length === 0">
            <p>Enter a pattern to see explanation</p>
          </div>
        </div>

        <div class="code-generator-section">
          <h3>Code Generator</h3>
          <div class="language-tabs">
            <button class="lang-btn" (click)="copyToClipboard(generateCode('javascript'))">JavaScript</button>
            <button class="lang-btn" (click)="copyToClipboard(generateCode('python'))">Python</button>
            <button class="lang-btn" (click)="copyToClipboard(generateCode('java'))">Java</button>
            <button class="lang-btn" (click)="copyToClipboard(generateCode('csharp'))">C#</button>
            <button class="lang-btn" (click)="copyToClipboard(generateCode('php'))">PHP</button>
            <button class="lang-btn" (click)="copyToClipboard(generateCode('ruby'))">Ruby</button>
            <button class="lang-btn" (click)="copyToClipboard(generateCode('go'))">Go</button>
          </div>
          <p class="hint-text">Click a language to copy code snippet</p>
        </div>
      </div>
    </div>

    <!-- Library Mode -->
    <div *ngIf="activeMode === 'library'" class="mode-content">
      <div class="library-layout">
        <h3>Pattern Library</h3>
        <p class="library-description">Click any pattern to load it into the tester</p>

        <div class="pattern-categories">
          <div class="pattern-category" *ngFor="let category of commonPatterns">
            <h4 class="category-title">{{ category.category }}</h4>
            <div class="pattern-grid">
              <div class="pattern-card" *ngFor="let p of category.patterns" (click)="loadPattern(p.pattern)">
                <div class="pattern-name">{{ p.name }}</div>
                <div class="pattern-preview">/{{ p.pattern }}/</div>
                <div class="pattern-description">{{ p.description }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
