<div class="template-browser">
  <!-- Header -->
  <div class="browser-header">
    <h2>Template Library</h2>
    <button class="btn-close" (click)="close()" title="Close">√ó</button>
  </div>

  <!-- Search Bar -->
  <div class="search-bar">
    <input
      type="text"
      [(ngModel)]="searchQuery"
      (ngModelChange)="onSearchChange()"
      placeholder="Search templates by name, description, or tags..."
      class="search-input"
    />
    <span class="search-icon">üîç</span>
  </div>

  <!-- Category Filters -->
  <div class="category-filters">
    <button
      class="category-btn"
      [class.active]="selectedCategory === 'all'"
      (click)="onCategoryChange('all')"
    >
      All ({{ getCategoryCount('all') }})
    </button>
    <button
      class="category-btn"
      [class.active]="selectedCategory === 'favorites'"
      (click)="onCategoryChange('favorites')"
    >
      ‚≠ê Favorites ({{ getCategoryCount('favorites') }})
    </button>
    <button
      *ngFor="let category of categories"
      class="category-btn"
      [class.active]="selectedCategory === category"
      (click)="onCategoryChange(category)"
    >
      {{ getCategoryIcon(category) }} {{ category }} ({{ getCategoryCount(category) }})
    </button>
  </div>

  <!-- Main Content Area -->
  <div class="browser-content">
    <!-- Template List -->
    <div class="template-list">
      <div class="results-count">
        {{ filteredTemplates.length }} template{{ filteredTemplates.length !== 1 ? 's' : '' }}
      </div>

      <div *ngIf="filteredTemplates.length === 0" class="no-results">
        <p>No templates found matching your criteria.</p>
        <button class="btn-secondary" (click)="searchQuery = ''; selectedCategory = 'all'; applyFilters()">
          Clear Filters
        </button>
      </div>

      <div class="template-grid">
        <div
          *ngFor="let template of filteredTemplates"
          class="template-card"
          [class.selected]="selectedTemplate?.id === template.id"
          (click)="useTemplate(template)"
        >
          <div class="template-card-header">
            <h3>{{ template.name }}</h3>
            <div class="card-badges">
              <button
                class="btn-favorite"
                [class.is-favorite]="isFavorite(template)"
                (click)="toggleFavorite(template, $event)"
                [title]="isFavorite(template) ? 'Remove from favorites' : 'Add to favorites'"
              >
                {{ isFavorite(template) ? '‚≠ê' : '‚òÜ' }}
              </button>
              <span class="category-badge">{{ getCategoryIcon(template.category) }}</span>
            </div>
          </div>
          <p class="template-description">{{ template.description }}</p>
          <div class="template-tags">
            <span *ngFor="let tag of template.tags" class="tag">{{ tag }}</span>
          </div>
          <div class="template-meta">
            <span *ngIf="template.variables && template.variables.length > 0" class="meta-item">
              üìù {{ template.variables.length }} variable{{ template.variables.length !== 1 ? 's' : '' }}
            </span>
            <span *ngIf="hasExamples(template)" class="meta-item">
              üìö Examples included
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Template Preview Panel -->
    <div class="template-preview" *ngIf="selectedTemplate">
      <div class="preview-header">
        <h3>{{ selectedTemplate.name }}</h3>
        <button class="btn-icon" (click)="clearPreview()" title="Close preview">√ó</button>
      </div>

      <div class="preview-content">
        <div class="preview-section">
          <h4>Description</h4>
          <p>{{ selectedTemplate.description }}</p>
        </div>

        <div class="preview-section">
          <h4>Category</h4>
          <span class="category-badge-large">
            {{ getCategoryIcon(selectedTemplate.category) }} {{ selectedTemplate.category }}
          </span>
        </div>

        <div class="preview-section" *ngIf="selectedTemplate.tags.length > 0">
          <h4>Tags</h4>
          <div class="template-tags">
            <span *ngFor="let tag of selectedTemplate.tags" class="tag">{{ tag }}</span>
          </div>
        </div>

        <div class="preview-section" *ngIf="selectedTemplate.systemPrompt">
          <h4>System Prompt</h4>
          <div class="prompt-preview">{{ selectedTemplate.systemPrompt }}</div>
        </div>

        <div class="preview-section">
          <h4>User Prompt Template</h4>
          <div class="prompt-preview">{{ selectedTemplate.userPrompt }}</div>
        </div>

        <div class="preview-section" *ngIf="selectedTemplate.variables && selectedTemplate.variables.length > 0">
          <h4>Variables ({{ selectedTemplate.variables.length }})</h4>
          <div class="variables-list">
            <div *ngFor="let variable of selectedTemplate.variables" class="variable-item">
              <strong>{{ variable.label }}</strong>
              <span *ngIf="variable.required" class="required-badge">Required</span>
              <p class="variable-desc">{{ variable.description }}</p>
              <p class="variable-meta" *ngIf="variable.defaultValue">
                Default: <code>{{ variable.defaultValue }}</code>
              </p>
            </div>
          </div>
        </div>

        <div class="preview-section" *ngIf="hasExamples(selectedTemplate)">
          <h4>Examples</h4>
          <div class="examples-list">
            <div *ngFor="let example of selectedTemplate.examples; let i = index" class="example-item">
              <h5>Example {{ i + 1 }}</h5>
              <div class="example-input">
                <strong>Input:</strong>
                <p>{{ example.input }}</p>
              </div>
              <div class="example-output">
                <strong>Output:</strong>
                <p>{{ example.output }}</p>
              </div>
            </div>
          </div>
        </div>

        <div class="preview-section" *ngIf="selectedTemplate.metadata?.usageNotes">
          <h4>Usage Notes</h4>
          <p class="usage-notes">{{ selectedTemplate.metadata?.usageNotes }}</p>
        </div>
      </div>

      <div class="preview-actions">
        <button class="btn-primary" (click)="useTemplate(selectedTemplate)">
          Use This Template
        </button>
      </div>
    </div>

    <!-- Empty State for Preview -->
    <div class="template-preview empty-preview" *ngIf="!selectedTemplate && filteredTemplates.length > 0">
      <div class="empty-state">
        <div class="empty-icon">üëà</div>
        <h3>Select a Template</h3>
        <p>Click on any template card to preview its details</p>
      </div>
    </div>
  </div>
</div>
